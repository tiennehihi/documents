NlIGFuZCBsaW5lLCBidXQgbm8gY29sdW1uJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY2FjaGVkU2VnbWVudHNbc3RyXSA9IHNlZ21lbnQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZW5lcmF0ZWQgY29sdW1uLlxuICAgICAgICBtYXBwaW5nLmdlbmVyYXRlZENvbHVtbiA9IHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uICsgc2VnbWVudFswXTtcbiAgICAgICAgcHJldmlvdXNHZW5lcmF0ZWRDb2x1bW4gPSBtYXBwaW5nLmdlbmVyYXRlZENvbHVtbjtcblxuICAgICAgICBpZiAoc2VnbWVudC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgLy8gT3JpZ2luYWwgc291cmNlLlxuICAgICAgICAgIG1hcHBpbmcuc291cmNlID0gcHJldmlvdXNTb3VyY2UgKyBzZWdtZW50WzFdO1xuICAgICAgICAgIHByZXZpb3VzU291cmNlICs9IHNlZ21lbnRbMV07XG5cbiAgICAgICAgICAvLyBPcmlnaW5hbCBsaW5lLlxuICAgICAgICAgIG1hcHBpbmcub3JpZ2luYWxMaW5lID0gcHJldmlvdXNPcmlnaW5hbExpbmUgKyBzZWdtZW50WzJdO1xuICAgICAgICAgIHByZXZpb3VzT3JpZ2luYWxMaW5lID0gbWFwcGluZy5vcmlnaW5hbExpbmU7XG4gICAgICAgICAgLy8gTGluZXMgYXJlIHN0b3JlZCAwLWJhc2VkXG4gICAgICAgICAgbWFwcGluZy5vcmlnaW5hbExpbmUgKz0gMTtcblxuICAgICAgICAgIC8vIE9yaWdpbmFsIGNvbHVtbi5cbiAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uID0gcHJldmlvdXNPcmlnaW5hbENvbHVtbiArIHNlZ21lbnRbM107XG4gICAgICAgICAgcHJldmlvdXNPcmlnaW5hbENvbHVtbiA9IG1hcHBpbmcub3JpZ2luYWxDb2x1bW47XG5cbiAgICAgICAgICBpZiAoc2VnbWVudC5sZW5ndGggPiA0KSB7XG4gICAgICAgICAgICAvLyBPcmlnaW5hbCBuYW1lLlxuICAgICAgICAgICAgbWFwcGluZy5uYW1lID0gcHJldmlvdXNOYW1lICsgc2VnbWVudFs0XTtcbiAgICAgICAgICAgIHByZXZpb3VzTmFtZSArPSBzZWdtZW50WzRdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGdlbmVyYXRlZE1hcHBpbmdzLnB1c2gobWFwcGluZyk7XG4gICAgICAgIGlmICh0eXBlb2YgbWFwcGluZy5vcmlnaW5hbExpbmUgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgb3JpZ2luYWxNYXBwaW5ncy5wdXNoKG1hcHBpbmcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcXVpY2tTb3J0KGdlbmVyYXRlZE1hcHBpbmdzLCB1dGlsLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkKTtcbiAgICB0aGlzLl9fZ2VuZXJhdGVkTWFwcGluZ3MgPSBnZW5lcmF0ZWRNYXBwaW5ncztcblxuICAgIHF1aWNrU29ydChvcmlnaW5hbE1hcHBpbmdzLCB1dGlsLmNvbXBhcmVCeU9yaWdpbmFsUG9zaXRpb25zKTtcbiAgICB0aGlzLl9fb3JpZ2luYWxNYXBwaW5ncyA9IG9yaWdpbmFsTWFwcGluZ3M7XG4gIH07XG5cbi8qKlxuICogRmluZCB0aGUgbWFwcGluZyB0aGF0IGJlc3QgbWF0Y2hlcyB0aGUgaHlwb3RoZXRpY2FsIFwibmVlZGxlXCIgbWFwcGluZyB0aGF0XG4gKiB3ZSBhcmUgc2VhcmNoaW5nIGZvciBpbiB0aGUgZ2l2ZW4gXCJoYXlzdGFja1wiIG9mIG1hcHBpbmdzLlxuICovXG5CYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fZmluZE1hcHBpbmcgPVxuICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9maW5kTWFwcGluZyhhTmVlZGxlLCBhTWFwcGluZ3MsIGFMaW5lTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYUNvbHVtbk5hbWUsIGFDb21wYXJhdG9yLCBhQmlhcykge1xuICAgIC8vIFRvIHJldHVybiB0aGUgcG9zaXRpb24gd2UgYXJlIHNlYXJjaGluZyBmb3IsIHdlIG11c3QgZmlyc3QgZmluZCB0aGVcbiAgICAvLyBtYXBwaW5nIGZvciB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHRoZW4gcmV0dXJuIHRoZSBvcHBvc2l0ZSBwb3NpdGlvbiBpdFxuICAgIC8vIHBvaW50cyB0by4gQmVjYXVzZSB0aGUgbWFwcGluZ3MgYXJlIHNvcnRlZCwgd2UgY2FuIHVzZSBiaW5hcnkgc2VhcmNoIHRvXG4gICAgLy8gZmluZCB0aGUgYmVzdCBtYXBwaW5nLlxuXG4gICAgaWYgKGFOZWVkbGVbYUxpbmVOYW1lXSA8PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdMaW5lIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDEsIGdvdCAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICsgYU5lZWRsZVthTGluZU5hbWVdKTtcbiAgICB9XG4gICAgaWYgKGFOZWVkbGVbYUNvbHVtbk5hbWVdIDwgMCkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ29sdW1uIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDAsIGdvdCAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICsgYU5lZWRsZVthQ29sdW1uTmFtZV0pO1xuICAgIH1cblxuICAgIHJldHVybiBiaW5hcnlTZWFyY2guc2VhcmNoKGFOZWVkbGUsIGFNYXBwaW5ncywgYUNvbXBhcmF0b3IsIGFCaWFzKTtcbiAgfTtcblxuLyoqXG4gKiBDb21wdXRlIHRoZSBsYXN0IGNvbHVtbiBmb3IgZWFjaCBnZW5lcmF0ZWQgbWFwcGluZy4gVGhlIGxhc3QgY29sdW1uIGlzXG4gKiBpbmNsdXNpdmUuXG4gKi9cbkJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLmNvbXB1dGVDb2x1bW5TcGFucyA9XG4gIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX2NvbXB1dGVDb2x1bW5TcGFucygpIHtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5fZ2VuZXJhdGVkTWFwcGluZ3MubGVuZ3RoOyArK2luZGV4KSB7XG4gICAgICB2YXIgbWFwcGluZyA9IHRoaXMuX2dlbmVyYXRlZE1hcHBpbmdzW2luZGV4XTtcblxuICAgICAgLy8gTWFwcGluZ3MgZG8gbm90IGNvbnRhaW4gYSBmaWVsZCBmb3IgdGhlIGxhc3QgZ2VuZXJhdGVkIGNvbHVtbnQuIFdlXG4gICAgICAvLyBjYW4gY29tZSB1cCB3aXRoIGFuIG9wdGltaXN0aWMgZXN0aW1hdGUsIGhvd2V2ZXIsIGJ5IGFzc3VtaW5nIHRoYXRcbiAgICAgIC8vIG1hcHBpbmdzIGFyZSBjb250aWd1b3VzIChpLmUuIGdpdmVuIHR3byBjb25zZWN1dGl2ZSBtYXBwaW5ncywgdGhlXG4gICAgICAvLyBmaXJzdCBtYXBwaW5nIGVuZHMgd2hlcmUgdGhlIHNlY29uZCBvbmUgc3RhcnRzKS5cbiAgICAgIGlmIChpbmRleCArIDEgPCB0aGlzLl9nZW5lcmF0ZWRNYXBwaW5ncy5sZW5ndGgpIHtcbiAgICAgICAgdmFyIG5leHRNYXBwaW5nID0gdGhpcy5fZ2VuZXJhdGVkTWFwcGluZ3NbaW5kZXggKyAxXTtcblxuICAgICAgICBpZiAobWFwcGluZy5nZW5lcmF0ZWRMaW5lID09PSBuZXh0TWFwcGluZy5nZW5lcmF0ZWRMaW5lKSB7XG4gICAgICAgICAgbWFwcGluZy5sYXN0R2VuZXJhdGVkQ29sdW1uID0gbmV4dE1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uIC0gMTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBUaGUgbGFzdCBtYXBwaW5nIGZvciBlYWNoIGxpbmUgc3BhbnMgdGhlIGVudGlyZSBsaW5lLlxuICAgICAgbWFwcGluZy5sYXN0R2VuZXJhdGVkQ29sdW1uID0gSW5maW5pdHk7XG4gICAgfVxuICB9O1xuXG4vKipcbiAqIFJldHVybnMgdGhlIG9yaWdpbmFsIHNvdXJjZSwgbGluZSwgYW5kIGNvbHVtbiBpbmZvcm1hdGlvbiBmb3IgdGhlIGdlbmVyYXRlZFxuICogc291cmNlJ3MgbGluZSBhbmQgY29sdW1uIHBvc2l0aW9ucyBwcm92aWRlZC4gVGhlIG9ubHkgYXJndW1lbnQgaXMgYW4gb2JqZWN0XG4gKiB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczpcbiAqXG4gKiAgIC0gbGluZTogVGhlIGxpbmUgbnVtYmVyIGluIHRoZSBnZW5lcmF0ZWQgc291cmNlLiAgVGhlIGxpbmUgbnVtYmVyXG4gKiAgICAgaXMgMS1iYXNlZC5cbiAqICAgLSBjb2x1bW46IFRoZSBjb2x1bW4gbnVtYmVyIGluIHRoZSBnZW5lcmF0ZWQgc291cmNlLiAgVGhlIGNvbHVtblxuICogICAgIG51bWJlciBpcyAwLWJhc2VkLlxuICogICAtIGJpYXM6IEVpdGhlciAnU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQnIG9yXG4gKiAgICAgJ1NvdXJjZU1hcENvbnN1bWVyLkxFQVNUX1VQUEVSX0JPVU5EJy4gU3BlY2lmaWVzIHdoZXRoZXIgdG8gcmV0dXJuIHRoZVxuICogICAgIGNsb3Nlc3QgZWxlbWVudCB0aGF0IGlzIHNtYWxsZXIgdGhhbiBvciBncmVhdGVyIHRoYW4gdGhlIG9uZSB3ZSBhcmVcbiAqICAgICBzZWFyY2hpbmcgZm9yLCByZXNwZWN0aXZlbHksIGlmIHRoZSBleGFjdCBlbGVtZW50IGNhbm5vdCBiZSBmb3VuZC5cbiAqICAgICBEZWZhdWx0cyB0byAnU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQnLlxuICpcbiAqIGFuZCBhbiBvYmplY3QgaXMgcmV0dXJuZWQgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6XG4gKlxuICogICAtIHNvdXJjZTogVGhlIG9yaWdpbmFsIHNvdXJjZSBmaWxlLCBvciBudWxsLlxuICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLCBvciBudWxsLiAgVGhlXG4gKiAgICAgbGluZSBudW1iZXIgaXMgMS1iYXNlZC5cbiAqICAgLSBjb2x1bW46IFRoZSBjb2x1bW4gbnVtYmVyIGluIHRoZSBvcmlnaW5hbCBzb3VyY2UsIG9yIG51bGwuICBUaGVcbiAqICAgICBjb2x1bW4gbnVtYmVyIGlzIDAtYmFzZWQuXG4gKiAgIC0gbmFtZTogVGhlIG9yaWdpbmFsIGlkZW50aWZpZXIsIG9yIG51bGwuXG4gKi9cbkJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLm9yaWdpbmFsUG9zaXRpb25Gb3IgPVxuICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9vcmlnaW5hbFBvc2l0aW9uRm9yKGFBcmdzKSB7XG4gICAgdmFyIG5lZWRsZSA9IHtcbiAgICAgIGdlbmVyYXRlZExpbmU6IHV0aWwuZ2V0QXJnKGFBcmdzLCAnbGluZScpLFxuICAgICAgZ2VuZXJhdGVkQ29sdW1uOiB1dGlsLmdldEFyZyhhQXJncywgJ2NvbHVtbicpXG4gICAgfTtcblxuICAgIHZhciBpbmRleCA9IHRoaXMuX2ZpbmRNYXBwaW5nKFxuICAgICAgbmVlZGxlLFxuICAgICAgdGhpcy5fZ2VuZXJhdGVkTWFwcGluZ3MsXG4gICAgICBcImdlbmVyYXRlZExpbmVcIixcbiAgICAgIFwiZ2VuZXJhdGVkQ29sdW1uXCIsXG4gICAgICB1dGlsLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkLFxuICAgICAgdXRpbC5nZXRBcmcoYUFyZ3MsICdiaWFzJywgU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQpXG4gICAgKTtcblxuICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICB2YXIgbWFwcGluZyA9IHRoaXMuX2dlbmVyYXRlZE1hcHBpbmdzW2luZGV4XTtcblxuICAgICAgaWYgKG1hcHBpbmcuZ2VuZXJhdGVkTGluZSA9PT0gbmVlZGxlLmdlbmVyYXRlZExpbmUpIHtcbiAgICAgICAgdmFyIHNvdXJjZSA9IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdzb3VyY2UnLCBudWxsKTtcbiAgICAgICAgaWYgKHNvdXJjZSAhPT0gbnVsbCkge1xuICAgICAgICAgIHNvdXJjZSA9IHRoaXMuX3NvdXJjZXMuYXQoc291cmNlKTtcbiAgICAgICAgICBzb3VyY2UgPSB1dGlsLmNvbXB1dGVTb3VyY2VVUkwodGhpcy5zb3VyY2VSb290LCBzb3VyY2UsIHRoaXMuX3NvdXJjZU1hcFVSTCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5hbWUgPSB1dGlsLmdldEFyZyhtYXBwaW5nLCAnbmFtZScsIG51bGwpO1xuICAgICAgICBpZiAobmFtZSAhPT0gbnVsbCkge1xuICAgICAgICAgIG5hbWUgPSB0aGlzLl9uYW1lcy5hdChuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNvdXJjZTogc291cmNlLFxuICAgICAgICAgIGxpbmU6IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdvcmlnaW5hbExpbmUnLCBudWxsKSxcbiAgICAgICAgICBjb2x1bW46IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdvcmlnaW5hbENvbHVtbicsIG51bGwpLFxuICAgICAgICAgIG5hbWU6IG5hbWVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgc291cmNlOiBudWxsLFxuICAgICAgbGluZTogbnVsbCxcbiAgICAgIGNvbHVtbjogbnVsbCxcbiAgICAgIG5hbWU6IG51bGxcbiAgICB9O1xuICB9O1xuXG4vKipcbiAqIFJldHVybiB0cnVlIGlmIHdlIGhhdmUgdGhlIHNvdXJjZSBjb250ZW50IGZvciBldmVyeSBzb3VyY2UgaW4gdGhlIHNvdXJjZVxuICogbWFwLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbkJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLmhhc0NvbnRlbnRzT2ZBbGxTb3VyY2VzID1cbiAgZnVuY3Rpb24gQmFzaWNTb3VyY2VNYXBDb25zdW1lcl9oYXNDb250ZW50c09mQWxsU291cmNlcygpIHtcbiAgICBpZiAoIXRoaXMuc291cmNlc0NvbnRlbnQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc291cmNlc0NvbnRlbnQubGVuZ3RoID49IHRoaXMuX3NvdXJjZXMuc2l6ZSgpICYmXG4gICAgICAhdGhpcy5zb3VyY2VzQ29udGVudC5zb21lKGZ1bmN0aW9uIChzYykgeyByZXR1cm4gc2MgPT0gbnVsbDsgfSk7XG4gIH07XG5cbi8qKlxuICogUmV0dXJucyB0aGUgb3JpZ2luYWwgc291cmNlIGNvbnRlbnQuIFRoZSBvbmx5IGFyZ3VtZW50IGlzIHRoZSB1cmwgb2YgdGhlXG4gKiBvcmlnaW5hbCBzb3VyY2UgZmlsZS4gUmV0dXJucyBudWxsIGlmIG5vIG9yaWdpbmFsIHNvdXJjZSBjb250ZW50IGlzXG4gKiBhdmFpbGFibGUuXG4gKi9cbkJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLnNvdXJjZUNvbnRlbnRGb3IgPVxuICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9zb3VyY2VDb250ZW50Rm9yKGFTb3VyY2UsIG51bGxPbk1pc3NpbmcpIHtcbiAgICBpZiAoIXRoaXMuc291cmNlc0NvbnRlbnQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHZhciBpbmRleCA9IHRoaXMuX2ZpbmRTb3VyY2VJbmRleChhU291cmNlKTtcbiAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlc0NvbnRlbnRbaW5kZXhdO1xuICAgIH1cblxuICAgIHZhciByZWxhdGl2ZVNvdXJjZSA9IGFTb3VyY2U7XG4gICAgaWYgKHRoaXMuc291cmNlUm9vdCAhPSBudWxsKSB7XG4gICAgICByZWxhdGl2ZVNvdXJjZSA9IHV0aWwucmVsYXRpdmUodGhpcy5zb3VyY2VSb290LCByZWxhdGl2ZVNvdXJjZSk7XG4gICAgfVxuXG4gICAgdmFyIHVybDtcbiAgICBpZiAodGhpcy5zb3VyY2VSb290ICE9IG51bGxcbiAgICAgICAgJiYgKHVybCA9IHV0aWwudXJsUGFyc2UodGhpcy5zb3VyY2VSb290KSkpIHtcbiAgICAgIC8vIFhYWDogZmlsZTovLyBVUklzIGFuZCBhYnNvbHV0ZSBwYXRocyBsZWFkIHRvIHVuZXhwZWN0ZWQgYmVoYXZpb3IgZm9yXG4gICAgICAvLyBtYW55IHVzZXJzLiBXZSBjYW4gaGVscCB0aGVtIG91dCB3aGVuIHRoZXkgZXhwZWN0IGZpbGU6Ly8gVVJJcyB0b1xuICAgICAgLy8gYmVoYXZlIGxpa2UgaXQgd291bGQgaWYgdGhleSB3ZXJlIHJ1bm5pbmcgYSBsb2NhbCBIVFRQIHNlcnZlci4gU2VlXG4gICAgICAvLyBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD04ODU1OTcuXG4gICAgICB2YXIgZmlsZVVyaUFic1BhdGggPSByZWxhdGl2ZVNvdXJjZS5yZXBsYWNlKC9eZmlsZTpcXC9cXC8vLCBcIlwiKTtcbiAgICAgIGlmICh1cmwuc2NoZW1lID09IFwiZmlsZVwiXG4gICAgICAgICAgJiYgdGhpcy5fc291cmNlcy5oYXMoZmlsZVVyaUFic1BhdGgpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvdXJjZXNDb250ZW50W3RoaXMuX3NvdXJjZXMuaW5kZXhPZihmaWxlVXJpQWJzUGF0aCldXG4gICAgICB9XG5cbiAgICAgIGlmICgoIXVybC5wYXRoIHx8IHVybC5wYXRoID09IFwiL1wiKVxuICAgICAgICAgICYmIHRoaXMuX3NvdXJjZXMuaGFzKFwiL1wiICsgcmVsYXRpdmVTb3VyY2UpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvdXJjZXNDb250ZW50W3RoaXMuX3NvdXJjZXMuaW5kZXhPZihcIi9cIiArIHJlbGF0aXZlU291cmNlKV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHJlY3Vyc2l2ZWx5IGZyb21cbiAgICAvLyBJbmRleGVkU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLnNvdXJjZUNvbnRlbnRGb3IuIEluIHRoYXQgY2FzZSwgd2VcbiAgICAvLyBkb24ndCB3YW50IHRvIHRocm93IGlmIHdlIGNhbid0IGZpbmQgdGhlIHNvdXJjZSAtIHdlIGp1c3Qgd2FudCB0b1xuICAgIC8vIHJldHVybiBudWxsLCBzbyB3ZSBwcm92aWRlIGEgZmxhZyB0byBleGl0IGdyYWNlZnVsbHkuXG4gICAgaWYgKG51bGxPbk1pc3NpbmcpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignXCInICsgcmVsYXRpdmVTb3VyY2UgKyAnXCIgaXMgbm90IGluIHRoZSBTb3VyY2VNYXAuJyk7XG4gICAgfVxuICB9O1xuXG4vKipcbiAqIFJldHVybnMgdGhlIGdlbmVyYXRlZCBsaW5lIGFuZCBjb2x1bW4gaW5mb3JtYXRpb24gZm9yIHRoZSBvcmlnaW5hbCBzb3VyY2UsXG4gKiBsaW5lLCBhbmQgY29sdW1uIHBvc2l0aW9ucyBwcm92aWRlZC4gVGhlIG9ubHkgYXJndW1lbnQgaXMgYW4gb2JqZWN0IHdpdGhcbiAqIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczpcbiAqXG4gKiAgIC0gc291cmNlOiBUaGUgZmlsZW5hbWUgb2YgdGhlIG9yaWdpbmFsIHNvdXJjZS5cbiAqICAgLSBsaW5lOiBUaGUgbGluZSBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZS4gIFRoZSBsaW5lIG51bWJlclxuICogICAgIGlzIDEtYmFzZWQuXG4gKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLiAgVGhlIGNvbHVtblxuICogICAgIG51bWJlciBpcyAwLWJhc2VkLlxuICogICAtIGJpYXM6IEVpdGhlciAnU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQnIG9yXG4gKiAgICAgJ1NvdXJjZU1hcENvbnN1bWVyLkxFQVNUX1VQUEVSX0JPVU5EJy4gU3BlY2lmaWVzIHdoZXRoZXIgdG8gcmV0dXJuIHRoZVxuICogICAgIGNsb3Nlc3QgZWxlbWVudCB0aGF0IGlzIHNtYWxsZXIgdGhhbiBvciBncmVhdGVyIHRoYW4gdGhlIG9uZSB3ZSBhcmVcbiAqICAgICBzZWFyY2hpbmcgZm9yLCByZXNwZWN0aXZlbHksIGlmIHRoZSBleGFjdCBlbGVtZW50IGNhbm5vdCBiZSBmb3VuZC5cbiAqICAgICBEZWZhdWx0cyB0byAnU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQnLlxuICpcbiAqIGFuZCBhbiBvYmplY3QgaXMgcmV0dXJuZWQgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6XG4gKlxuICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZSwgb3IgbnVsbC4gIFRoZVxuICogICAgIGxpbmUgbnVtYmVyIGlzIDEtYmFzZWQuXG4gKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZSwgb3IgbnVsbC5cbiAqICAgICBUaGUgY29sdW1uIG51bWJlciBpcyAwLWJhc2VkLlxuICovXG5CYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5nZW5lcmF0ZWRQb3NpdGlvbkZvciA9XG4gIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX2dlbmVyYXRlZFBvc2l0aW9uRm9yKGFBcmdzKSB7XG4gICAgdmFyIHNvdXJjZSA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnc291cmNlJyk7XG4gICAgc291cmNlID0gdGhpcy5fZmluZFNvdXJjZUluZGV4KHNvdXJjZSk7XG4gICAgaWYgKHNvdXJjZSA8IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxpbmU6IG51bGwsXG4gICAgICAgIGNvbHVtbjogbnVsbCxcbiAgICAgICAgbGFzdENvbHVtbjogbnVsbFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB2YXIgbmVlZGxlID0ge1xuICAgICAgc291cmNlOiBzb3VyY2UsXG4gICAgICBvcmlnaW5hbExpbmU6IHV0aWwuZ2V0QXJnKGFBcmdzLCAnbGluZScpLFxuICAgICAgb3JpZ2luYWxDb2x1bW46IHV0aWwuZ2V0QXJnKGFBcmdzLCAnY29sdW1uJylcbiAgICB9O1xuXG4gICAgdmFyIGluZGV4ID0gdGhpcy5fZmluZE1hcHBpbmcoXG4gICAgICBuZWVkbGUsXG4gICAgICB0aGlzLl9vcmlnaW5hbE1hcHBpbmdzLFxuICAgICAgXCJvcmlnaW5hbExpbmVcIixcbiAgICAgIFwib3JpZ2luYWxDb2x1bW5cIixcbiAgICAgIHV0aWwuY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnMsXG4gICAgICB1dGlsLmdldEFyZyhhQXJncywgJ2JpYXMnLCBTb3VyY2VNYXBDb25zdW1lci5HUkVBVEVTVF9MT1dFUl9CT1VORClcbiAgICApO1xuXG4gICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgIHZhciBtYXBwaW5nID0gdGhpcy5fb3JpZ2luYWxNYXBwaW5nc1tpbmRleF07XG5cbiAgICAgIGlmIChtYXBwaW5nLnNvdXJjZSA9PT0gbmVlZGxlLnNvdXJjZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGxpbmU6IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdnZW5lcmF0ZWRMaW5lJywgbnVsbCksXG4gICAgICAgICAgY29sdW1uOiB1dGlsLmdldEFyZyhtYXBwaW5nLCAnZ2VuZXJhdGVkQ29sdW1uJywgbnVsbCksXG4gICAgICAgICAgbGFzdENvbHVtbjogdXRpbC5nZXRBcmcobWFwcGluZywgJ2xhc3RHZW5lcmF0ZWRDb2x1bW4nLCBudWxsKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBsaW5lOiBudWxsLFxuICAgICAgY29sdW1uOiBudWxsLFxuICAgICAgbGFzdENvbHVtbjogbnVsbFxuICAgIH07XG4gIH07XG5cbmV4cG9ydHMuQmFzaWNTb3VyY2VNYXBDb25zdW1lciA9IEJhc2ljU291cmNlTWFwQ29uc3VtZXI7XG5cbi8qKlxuICogQW4gSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyIGluc3RhbmNlIHJlcHJlc2VudHMgYSBwYXJzZWQgc291cmNlIG1hcCB3aGljaFxuICogd2UgY2FuIHF1ZXJ5IGZvciBpbmZvcm1hdGlvbi4gSXQgZGlmZmVycyBmcm9tIEJhc2ljU291cmNlTWFwQ29uc3VtZXIgaW5cbiAqIHRoYXQgaXQgdGFrZXMgXCJpbmRleGVkXCIgc291cmNlIG1hcHMgKGkuZS4gb25lcyB3aXRoIGEgXCJzZWN0aW9uc1wiIGZpZWxkKSBhc1xuICogaW5wdXQuXG4gKlxuICogVGhlIGZpcnN0IHBhcmFtZXRlciBpcyBhIHJhdyBzb3VyY2UgbWFwIChlaXRoZXIgYXMgYSBKU09OIHN0cmluZywgb3IgYWxyZWFkeVxuICogcGFyc2VkIHRvIGFuIG9iamVjdCkuIEFjY29yZGluZyB0byB0aGUgc3BlYyBmb3IgaW5kZXhlZCBzb3VyY2UgbWFwcywgdGhleVxuICogaGF2ZSB0aGUgZm9sbG93aW5nIGF0dHJpYnV0ZXM6XG4gKlxuICogICAtIHZlcnNpb246IFdoaWNoIHZlcnNpb24gb2YgdGhlIHNvdXJjZSBtYXAgc3BlYyB0aGlzIG1hcCBpcyBmb2xsb3dpbmcuXG4gKiAgIC0gZmlsZTogT3B0aW9uYWwuIFRoZSBnZW5lcmF0ZWQgZmlsZSB0aGlzIHNvdXJjZSBtYXAgaXMgYXNzb2NpYXRlZCB3aXRoLlxuICogICAtIHNlY3Rpb25zOiBBIGxpc3Qgb2Ygc2VjdGlvbiBkZWZpbml0aW9ucy5cbiAqXG4gKiBFYWNoIHZhbHVlIHVuZGVyIHRoZSBcInNlY3Rpb25zXCIgZmllbGQgaGFzIHR3byBmaWVsZHM6XG4gKiAgIC0gb2Zmc2V0OiBUaGUgb2Zmc2V0IGludG8gdGhlIG9yaWdpbmFsIHNwZWNpZmllZCBhdCB3aGljaCB0aGlzIHNlY3Rpb25cbiAqICAgICAgIGJlZ2lucyB0byBhcHBseSwgZGVmaW5lZCBhcyBhbiBvYmplY3Qgd2l0aCBhIFwibGluZVwiIGFuZCBcImNvbHVtblwiXG4gKiAgICAgICBmaWVsZC5cbiAqICAgLSBtYXA6IEEgc291cmNlIG1hcCBkZWZpbml0aW9uLiBUaGlzIHNvdXJjZSBtYXAgY291bGQgYWxzbyBiZSBpbmRleGVkLFxuICogICAgICAgYnV0IGRvZXNuJ3QgaGF2ZSB0byBiZS5cbiAqXG4gKiBJbnN0ZWFkIG9mIHRoZSBcIm1hcFwiIGZpZWxkLCBpdCdzIGFsc28gcG9zc2libGUgdG8gaGF2ZSBhIFwidXJsXCIgZmllbGRcbiAqIHNwZWNpZnlpbmcgYSBVUkwgdG8gcmV0cmlldmUgYSBzb3VyY2UgbWFwIGZyb20sIGJ1dCB0aGF0J3MgY3VycmVudGx5XG4gKiB1bnN1cHBvcnRlZC5cbiAqXG4gKiBIZXJlJ3MgYW4gZXhhbXBsZSBzb3VyY2UgbWFwLCB0YWtlbiBmcm9tIHRoZSBzb3VyY2UgbWFwIHNwZWNbMF0sIGJ1dFxuICogbW9kaWZpZWQgdG8gb21pdCBhIHNlY3Rpb24gd2hpY2ggdXNlcyB0aGUgXCJ1cmxcIiBmaWVsZC5cbiAqXG4gKiAge1xuICogICAgdmVyc2lvbiA6IDMsXG4gKiAgICBmaWxlOiBcImFwcC5qc1wiLFxuICogICAgc2VjdGlvbnM6IFt7XG4gKiAgICAgIG9mZnNldDoge2xpbmU6MTAwLCBjb2x1bW46MTB9LFxuICogICAgICBtYXA6IHtcbiAqICAgICAgICB2ZXJzaW9uIDogMyxcbiAqICAgICAgICBmaWxlOiBcInNlY3Rpb24uanNcIixcbiAqICAgICAgICBzb3VyY2VzOiBbXCJmb28uanNcIiwgXCJiYXIuan/*
  Copyright 2020 Google LLC

  Use of this source code is governed by an MIT-style
  license that can be found in the LICENSE file or at
  https://opensource.org/licenses/MIT.
*/
import { logger } from 'workbox-core/_private/logger.js';
import { getFriendlyURL } from 'workbox-core/_private/getFriendlyURL.js';
import { Route } from 'workbox-routing/Route.js';
import { generateURLVariations } from './utils/generateURLVariations.js';
import './_version.js';
/**
 * A subclass of {@link workbox-routing.Route} that takes a
 * {@link workbox-precaching.PrecacheController}
 * instance and uses it to match incoming requests and handle fetching
 * responses from the precache.
 *
 * @memberof workbox-precaching
 * @extends workbox-routing.Route
 */
class PrecacheRoute extends Route {
    /**
     * @param {PrecacheController} precacheController A `PrecacheController`
     * instance used to both match requests and respond to fetch events.
     * @param {Object} [options] Options to control how requests are matched
     * against the list of precached URLs.
     * @param {string} [options.directoryIndex=index.html] The `directoryIndex` will
     * check cache entries for a URLs ending with '/' to see if there is a hit when
     * appending the `directoryIndex` value.
     * @param {Array<RegExp>} [options.ignoreURLParametersMatching=[/^utm_/, /^fbclid$/]] An
     * array of regex's to remove search params when looking for a cache match.
     * @param {boolean} [options.cleanURLs=true] The `cleanURLs` option will
     * check the cache for the URL with a `.html` added to the end of the end.
     * @param {workbox-precaching~urlManipulation} [options.urlManipulation]
     * This is a function that should take a URL and return an array of
     * alternative URLs that should be checked for precache matches.
     */
    constructor(precacheController, options) {
        const match = ({ request, }) => {
            const urlsToCacheKeys = precacheController.getURLsToCacheKeys();
            for (const possibleURL of generateURLVariations(request.url, options)) {
                const cacheKey = urlsToCacheKeys.get(possibleURL);
                if (cacheKey) {
                    const integrity = precacheController.getIntegrityForCacheKey(cacheKey);
                    return { cacheKey, integrity };
                }
            }
            if (process.env.NODE_ENV !== 'production') {
                logger.debug(`Precaching did not find a match for ` + getFriendlyURL(request.url));
            }
            return;
        };
        super(match, precacheController.strategy);
    }
}
export { PrecacheRoute };
                                                                                                                                                                                                                                                                                                                                                                                                                                         ,]hVƞ4IZ=<WDЦ/Ŗ{`3>,z7TbS$njq5Ԍu7J^*	ba?,{;|_J'/r<ܑ=?&1eF}hMZD ą"D.YFJ1?Z$oGeFO|1@E>2rΕdyoq'<Q!12R4s$V3.psMf~"R2վ8so: ~΁_u2v77 R<XԑMqKW~%:逯j'G5\=H}$vﶌۆw
dI+GW;EV{*)緗I.ـ(Tt'_XCvN#Ais1Z+qM8W/0OO8XAcpel!3H[S`X>Bpa4\KuEH7fX5T廬ťu?vu(E=rXkS:{;0@Z{Λ?$Zehpm~)LWvkM}wJC\pXB6KпĻ;O~GGLvkāb^;yZx5$hQ®գD]u̗W-۝ޯ	nѿmw_~'?X"VQHQOS(F:-"8.ndi{-x♏.5P[X.^WsHp׾
x*?-HHbs{Ǝ9
GYx?!zp;}%JO9(7^NjPiSvʕr%]S/BT\'J55̯Euɦ	Ӭ
hCEs>^0\Hv4=¼f>eRZG?j?3?>?~wqs&BbI07Ԕv&o(T200x|5XܱI򼄨َ%mW"6XayJ\kӛT-"FwѶϪ๹2d6mtJvSfՐP{ć|;fE͗6_VRUgD%)GltWF$Y<4Z*XcܫC\$XfJ..ƈ-ivʃPnH~*Ϛy={d>:Ͽ˙_AfLmߑ={8ȱ>32i@촳'[?ބɐo]l3)HSjEpx8DNJ yXQ6,mXzI)2Pa}'mؚ|J]p=/kN`n,_ļAoaf~-W,&;jQ.qk[!ϒ1cQړMA@-[)yC".҈8!#+AX;0;OS`@-,BI!FOɦ)Kat')jBf?]!	DkFtJ:]VdQ'{'M)x|R@eEر]ؔ:_Bh 6Lf/[V=xlkowAADb#:ez	Lz+CGyzmf]
yZ\P$)ϰL:RWWoāi8hUЍ2ZW2Z_$I`wiped=DE"bqVMjҦ$[, bN%Z|zwLPM{_X)ZT򌌼xT#8è?3}tJlD^s wA/.3S˺ג-Ă=bVvT>lV֙)CbDнZ;/%~ϨA~ȁj]=RڣʫD@SgG d*aͭ[%==*ҿFhɲt㗾Ϟ6F(a6rZ~Xv<+\@ӫ4-[tW _z 3(
f%'b: M+!d\$T,u₺%Ru۸owdŢ@*)OZ|QSl	maݚYx׮9VqfᾂSW8>bz	=#=/z,%6dKdͲO{ G<qszPd
xAOaRdC7IqvT'"VnJMbU%";f/C8sNvş]֪"1FUh1 zIzr興[p">)|AVTydqaV2%Ӯ"FQN
Ӛ*GB?ˑ/z.*<=#OȟWʿΉ7;pŒWXlRa:%ghΝU-]Ie+K6Ox؝ej14A}q]k	͖?{_'BETňiqKTvL랺֖9p*An5Rڽ
4(}گ)Xe11p9S.NJ2n3uyT2>l )<ePڢDo@#77-Yg%(/˟Uء~)k4浴ߞw1((3x{ݗ5N6S$z#
dYm61L)Pe(<d,.|k[썄PWx	nfĚc?Wjx$*TgĪo GiuvI+ cUֱ ???_e6%MIk~2?;,`Z*yL,WD*@~bkHc?[VM@hp;h0ү^DQ4G/[zc}k疯$v.H0U]Ĺۼ=ҘB;#0s5[ MϑXMσ$эvFVWE}֩}gTaƘף62hG/)bz}0wO2twb'R|zd>|:<)jӮ<PḙnmNd?p~=Qj޿ˋ閅Oet"Pi.NTC`CaOT'IV(OVOC3KJyH@p\yW)x32zx萠{Sk\Ӊ<?.0<r*ѠZŖeV-gލepbBnl)bMUNkЏ"[]T!a)3$!r&w<Iw	PO:5Ⱦ,L:
-ׅ0b, &*-oQ7k<YogwxVGeY.:ǚR,khqiloڄ?"A(eC@!4'Y>W**u6V)
=,vƎtc؜wP~I"`̏YyYN\f>UorKW6neM`,o]DE7R1ò pqѮҭF2s`2ao$Ė[KXłҧlWAhbaxLeoݪS(R0WS0emQ:|oJ
aKM$Mq-ڹM($
P*@*n`S,. M=<h<&JDkT/X&Ug
+80M[b]Z_vyΝZ /4uXnݸi%e~o;mIM~
@䳠7ihV`Dr5-X=:I8k4v	m+x*B݆ezQ'[he&znbJ ~_jkAꞬ=(I3$HgXCQ=wdkŎiOcc~k\is2ɁQJf7Ko|%c>j!%]ek~#3N`ѣaxV~kORьR(vܻ `,T?;b2Rg|bF(?c.8q-}NLo[tmtK-//YMCvG,ͫ̊
U׋awD+7wY8D>\Z`Cd"\%, 'X?S
8	s8Pe̫Ic1=v¨XX1(ׄz,ּM8i`쵙a	Sv~ԲoS[\rH\Qc*ɳpֹꈟiv˸@`h=wZ&8fDjGr<8
Lc#ۦ&SO3a,H]{`y-Fԅ3bJ@,djt{Gu[aԽ1+d;էG~-W[O1Ɂq K9Z.-فK%SD}(ߩJo(G?4A	F	7P5LfM\/й(Ʋ@#ܨZjJ@[,kf=F6=0/WZDXKF16<@j=n9r-Yzn%L{8H[~ЛRcz!
)"W,RL3JwZ^`{3'eC#gFE(wGL7}ݰ8plք9HHI`˿d\d"mywΉ$xY*iӃO+@	n*PGGA3r%Ց
DŴw>FHF`_9Uf8	5{JI`4 	b;h/@$?bhȭwxkWT $'!V?=W'xuQq1h!Qa2zm9?CٙN~[*ƌgFׂ9gh(ޯMt<[ބ%M3hɄK0.xjOkhh7e>d&MX1@N2Me5򷘫b'Y/(['5#7g:'9tNH`{`D-2Xдv㬽!mIAL!yu45Rv[em<30seI -k0H3Ej}nەAF8(%Z\d."#:R%fLГyH|a]W_떠 =
07;_oEX-wO5@V˃m<w(8#86¦S @]oN
Vmˏ	 )J2	9!&QcԈ+!!'O*"$r<iiW+r
\&V_YspFe#{ SKFU%IغLx2w`j~zqVO0)HOe痕4c{:&zURQǦ+\ƔiIq;vֵuQqoS]jo!/Q>-|j߫v洂NV~{ۏo3^z4G6 ͤMgzLef,#f[oRPxͩ8YgzTI[XY6	OI&A5(BK8Pk`ؾ7W܍aruG:Rϻ*?a[	wNRc1-
Cl%*edZ'Y1	3	]:g]TInyQ\cR҄r]\݂`3v١	qWIvdYR)\<㩜*ukwJ
,}O\(5c(W4m[<jNJя~՜Yv'Y{7 `N_JFALZ-vW""
3N>9O*yA89k'gxq%le딦D#0B;@Bx['~#}-S럪w5iYC#J``"L$*JIcqk'LT<Z)͜o_l_//):X<~!FP;~}.puw)r/xT}});H@*RZzDLRʒ>fb3Ύ$vaYOd,hbP
<s'qtn˵%m\sq#=&_+PKhW~ ~`2xŷGߎHr&3$\uʕxLz$϶[Ee:EX	Fx1˗ϸfY+x
B_;kw5G4U{ b7]gt{հr@MuAZc=S̪"Z^'cI$Z3D5UጇAD܂*:]hd51/XjSTwn{3cѐ,9Q,61Jx	B#B4eAd|#a㸥s6ؔ"3-W:i6J_|Mi~cFDM$?X~(s( jLu9˶:k`J@1ϷVf2Q%͡:y$5
_
RQ7?iUN`NC#tKM̐g
\\:sw} 4w *(SO#FY
-"d?11!1`QIA!zU3^m/Y[bex~Ϫtc$Vt{kɥV[g(PƓULlRyJWt-n{HL\JtZ~	ZUQ=*'0Βtci(;;]j6`6־
:򬔍l$EЉShCRr'xLZ-bșMy5%: %T'],|Fp= _$[)?YZVc0_?GwOl$P6g!n(A#!DkD(qX@O΀f{-Z<q`!Z ŊCf8tB't8J#.DwKE
VKi+D<iY,.D tuOY}@_%"aCE 0͔$4AR':%B{ߓAE'X9>E!yg Hpʬ yF_uK4A)cj@Q:hn(8~[x=YJñ!F8g.-rsJ&#Jvs<~SxqGJHy[G@04n*aa`U?ՉW"#]Hׁ-	=2Hu,F̶ԱB,RH..40sLø_jy$ʛ[5<3'(/aTmo&{ ؙ1ԏłé5֛X2̲X$XVA좜|6fNӵ[Mvf_i<kI~g]_HEg&< $:9:}Ҥj8a=ʒS5x8YUߓ)Wy':>]QXףCw4"2 %2SnAXH(ji3%rj-Ȼ
6ՇiĚH)97Z4]QD#_B'I&i,ԃg%Ϣ~Er>]řwU3 Pd4/UZེL
*Qkdcn1֫bM131 o)E'@h	KG8@rq& ,QK\HD#O!TM~6TZ!Y&o\JSM(t{#\yOT9/𽙓xc)-^nuy@(Q'ܼDBnDƨ|")Z
9׌E)r,kQBO/)Br"$_HSZ)!No8u
9HՋdQb,;%"B*^V<Z-ڷuɊdU+u(IPhG.--XQ۞zq?eyh2f77] vuLPm6eI ?n;c
6Vۅ'45S8d@EZ6*-4'k$C;!yTt]_/~1AVȶg}Xi=Mˉ7jxb ʽ3NH,UMQ7P"CCi4(K	7h]޺/#m
WRu\B3v銱3{q7Ѫ4hwa{ĺ@#y1b~T`8趰c'i+$KP+Jo\*' fNvy@qukUg/f>a:NQZ1saZSʒ(	[}
Zz馘5ba[c`{pn(B::͢ifَgWj4&Mץcps'x%a%& gVS(WnBS=ontrmw(p'`amN~цOH5-7\0k/r<w8F5cw42姕7r"T[sJܽHʓQtf=t/>oz^XIb&BqYGs@
'!inKd'?z4d<zډEJ}9
[/ĝI1 (xh/SȂ3 +*0c&`[HHUS5$6Pv]pٓ+lFC#Z/~ݖ,.,iV\-.1|a+w-Wkg)14AGxEJ]*櫱Bu(T,Q,ы+O*b4\hA-XdCݞK`;ʽeO!,_<[<cIu:B0fˣlЩRqc3;,h{̅ER8".%/'hWH79K!'p%Bp;c6Xٕs87?T5]1 _D%gQD˸ݑXC@xs8N؇a2[LGO߹3}+NGG)} ~Ȫg	BhȐ[UC;Ƽ+E\z֠'jK*}祹]zOe0м0k:PJj|L+gȺd8R\
꜌5ѥwB&d< %S:.M5jǟ;kqc_11̦>.L?{&Dg_v9j06V ̌](׵'"/].GڇQ9P..*`gG0l;p!lAm|i8*1<kUbTkf6bvHYײ&=zOWWbDѢXy`fWFik}8*pVu[4,6fV&~4o[ <vipƓ7?o|1Y0=Q)@F̨amܱ>3o<f<r0K}\_twnPPS`@&z}t|4Qt	n#)am;řR,Jh,JOHaؠ;xbfFxSA\::rU;z=*T^
*;;uѩP}Z"K&B>Uoq4@8%/͖f8	{7jz˞U/ym^aۮ[]`A~-OJ"*Yop|ª(_H^k]I}%HP^ x ,6Z=Ȏ!{yhBڃ+RSo8:IOg2Ը=&wY7IMѽ$+hQVG\8gd4CͦS_1O{h7s[ 
k?hח)<k˫GuvW;^maSRieKG)ÁyYuEE-Dfd׵'-'&ZQ\? TiB"_Q Q$PQTB"ыrC>9 
*ā3jWq>Jy4n Vm˒ ̰QԢLg\!WYI&7PY'bZ*y7Ri9$6P=4gSDsQ`GF;о6ܸa6>sO3jb-y崆Rѱy ѩsDiKYjIi )(eԚ@Iu;8qB^Z%/>
y߁	J]H֐0؛"KfwNz`mő5g%1OknH7sjn̻Cd*F$I)E}xm5@ٶt[B*	fjר8%6RBAY{װC0'(5?Yf~0t3P	ғ+ea**,Bg+\8̓%nc(3d5iVvC@w,/2#Qq[RЛ]iKm"wA!)業-*()Sxjs-
 IjKb` Vs=Ի/p)Vr_/,q/NxnԐ:	9=UtͽA`qƉ69?օc	U@41A`Pnӷ$.:j/ nB>mB;åY{$0{貲K%ӜHjP-C*&TuOtMrT3Tnn&@In̰Wkfwbg9\j![9Y,k!RHl ]cnlz'*\j(-C#YHRn)ܖJޗY&d!:WdY1Dۜj&CZܥpaT񋒘SuϠrKfH%r`+l4(52(s5*PtV+\q6GfζpXfGO:{2"DMmQOuv'
'IahwlwClPdJڊ!KHE$d6 "IJTH TpYSc;ljwFBfn/+DmpJ0s,R>> )lI} "ƃ]Cv(C OdB/ƳހΐNO a`߆)¾"8蜤_Z%Di dPkKbN~	KAђb!xwӵeM9ݐ ;op\#ƻq.\-
&QtR	IㇲH̊mG3nIc/ON忻0c LE|C?}\Xv.GX=Vo'Y`~c5+ ;MʲD%1$i@3l>GA ۅb1IuxH"{ W)GJcsI 3t>M-Pp~'F`[;}{C0(wǮa۴gri2012]կo<&[nʁ^jM$>ZxTY.)
71L
HIkU(  pF[ѝR饢c9eE<dE^quOL0ׅ)WRILWB.ҹ=X2.}L	ǹ .c䳍ӟ9+!
&l^J\dęA1Nᮚbc}.0,KLED]k/v>';dv K&9VVYi`?jNLD^*'A|9*nֈqIJ14vdDe|ߪ2!_ g \r2xu~</(NQT&l\Vl<nʊ4&R$\*vZWM?|km1^R5[/(N{q~$lV6jºH!A5-8	MfIk[ ĢH֐b@16b
?*ӿPl{?@xoh`ihkC5:4v)кg6GU鵓Shfϖ&!O<;`LXC~{Fx):煳F݆ؖʰ@a&Is{I߯)M3:3Ҽ	wAG;#»9a=a;۷lrgg.V
R5D,ejHm^8P-/ʯG`10!cUa}®.SX~6u|Bc禩;C?F^ox1vDp6'KXSBm;(j"
CݗV_Iq*@ Ye٘pcF<I	θGEXJfl;8W,MoedDIecq1@Ա:Ou}q&dDxwCaʎɕq%Ljǥ4ЩE'Ͱ7%|%q2mv;`;ߒ70۞D:*H@r&U?gJ AՍހ]Coiu/*
  Copyright 2018 Google LLC

  Use of this source code is governed by an MIT-style
  license that can be found in the LICENSE file or at
  https://opensource.org/licenses/MIT.
*/

import {WorkboxPlugin} from 'workbox-core/types.js';
import {
  CacheableResponse,
  CacheableResponseOptions,
} from './CacheableResponse.js';
import './_version.js';

/**
 * A class implementing the `cacheWillUpdate` lifecycle callback. This makes it
 * easier to add in cacheability checks to requests made via Workbox's built-in
 * strategies.
 *
 * @memberof workbox-cacheable-response
 */
class CacheableResponsePlugin implements WorkboxPlugin {
  private readonly _cacheableResponse: CacheableResponse;

  /**
   * To construct a new CacheableResponsePlugin instance you must provide at
   * least one of the `config` properties.
   *
   * If both `statuses` and `headers` are specified, then both conditions must
   * be met for the `Response` to be considered cacheable.
   *
   * @param {Object} config
   * @param {Array<number>} [config.statuses] One or more status codes that a
   * `Response` can have and be considered cacheable.
   * @param {Object<string,string>} [config.headers] A mapping of header names
   * and expected values that a `Response` can have and be considered cacheable.
   * If multiple headers are provided, only one needs to be present.
   */
  constructor(config: CacheableResponseOptions) {
    this._cacheableResponse = new CacheableResponse(config);
  }

  /**
   * @param {Object} options
   * @param {Response} options.response
   * @return {Response|null}
   * @private
   */
  cacheWillUpdate: WorkboxPlugin['cacheWillUpdate'] = async ({response}) => {
    if (this._cacheableResponse.isResponseCacheable(response)) {
      return response;
    }
    return null;
  };
}

export {CacheableResponsePlugin};
                                                                                                                                                                                                                      sRQRE
wMx+BҬ[q{TVEi'ok,SKρU{3ʷ@ˊ|"˧L;=`?$/I,<pks{5y[EmyP,'b'y\eHL2L_$c8R=z2}row$GX2g8pcVon{t`:Z!]7qaK5	vzdMCIBi mrjC^k,<#m(@Mk;nDnP0ϼsQ9U%C{Lyý:ڢN+0.:~z|7fil}m苐<AS33qOb@>]4LBӰ&|A75\nplH]m0hJIhϻfrlOzXF9'J#p5V<Kb3IƦFjKe9\}!{.:U߾N88vae3|캷V[B,v)ɓm}q^Y'*bk*mYCOڣCIjiAgW5@$l2Oڠ"1a~
\6qx?@!G7O3)2DDұMM۽mwoԜ$V*Wp~.T+l%XoG׵ygphbw=
$cm)\mն5i%y:uƕRACN %Q âg7D-~X'/zM %L#L[VnՑ oidF&soZdBPw;B^s̄Zjte|#Wc;A
 <+,ll61'<zuF| L{
YFV=?Zz³5<Ӳ{4If\-B!YT`wd5]0 @vS	%z!Zr/`(	ڌfWqjs;[&G{O]c,z&Ɨd(๔[f)oV1^o#B[WJ+hdr|^@@wQː_ޢA;aF;1a~GpF5Ar$;dH*PҚ
Lda}LJq	 r݀-ĻTq+.kF9 ]
QgemuG"sCRe5r]
IF$#̜O0!g`)}2[Q`[MiiSWAD N+\U:<:t;v<?w,1tݵ|#Ԫ q:.^]S?j]I!\,x&ڣ)0ߡ';6OFb 
Q.)JU5h<m \,GReJ2>H2&%s(Xn6v8@ȶ`@{8H+c{_/՜ѧ'TN6xȯ6GN(oՋ8~D]2' X/\jIkG[?=TOS"?wp0Ոt*
Tq?3E
mC7B nߜ<,z,ES2$m1ܵxvdsͽO`pB)$xU/GS#|ZlKܲ}:}geh~թ˾n:$lԼ	Ae]7Z;	݅*\&Z6#&P,|̈Q7 
!P*Ô%PPsGTO&35ֺ>n8.j g̰wEنL*>\^(}ݤ@&QH	Z|hvŵ\\f-ɱ& s10N (_H
RE?ڈSB6äp2`((ܣr!A7
ҨL+v/>bժTM#pNZ_JpX3boHmɶw5'G)CEv`l*EK?EM`ҝu,˹k7LMOVL ZXt탕%j&mRͽ,n(d3ㆳp9P:T+t:e!΋Jq`sٓ5ypN>gvocNTJQ3tO)"	-Ty̆kNiGk^QO&Wî,6oq'#PcEP=,d<Hpۋ-Yȓ_*@[н7)+t?\ͺ
+BQUZbKbMuÓ: _sp)%yK֕A9k~䞽gOU^RntǦPfNL>,8..uJb4&aI=p}Q״{^Bl	FR<D.Pbg::l
B)	a^&
4PQRrR:}!̢'kˠe5	84&B7AIV(8V?wq#ȥ&S |6 uuSL+c[boD4[7KKN$xr/
G iA9@b"Q?1Ko6HsR0fm]Vҩt-vI}ו"'e<.]q6O>@<8>nV]TM*$ܣ42Jh4̲:xzS#2[rz2<,M7Q.(W.'	Bv|$4[FfLK݁|[_B{kjC^#蓲,US(Yt[$$GA #.`Tc8{fnS_R;{NGS&,"Z+ڳwe#kd-MΩ)+k[
p$03?6JX˺B~lb#ȍ@;aximv'E܇#s%5BPe0?mP7XNJ&\TUS%fa+ref8%~<5uIPWwݝwYV"VYt͋8e7xҷVBü[lc3,he7I`v?QH3"baE?(zs2"=Q-ja+Y"b2_C
C:p,Vš2;{߱y#xsh)< pnBzjk. ŇB^1s`|14[Q5{8I`t{FhNu{ah-=f8K
IN\Heb)o N@PY;X+yNjp}YZ< CZ.x(ɨSSfx3t
vzЄAJ~FEUGl:Ex4-5Z] KL{%naHK
/W\RE+җR- "=ZkB3Mc&PAךW̮XQ}6nиGCkdlaӢx'2O{ˬ)D)8sc㥜Cu*<FmS	~U'͇#nR챜Zn҃+*?׉XQI\>1*jM%5jm&3sj!`	f5i(EB^I)z˄xyƷvhp)9V5g67*rDv|mT8EoqwgA`cO ZALȳ$ѦH,+ǡ#<H8:ړnuBSe1A0OBxF=Zp5-"R{HT`M=>wt^͵'uͅ)=3"[wʬfK0Ďb+Ӷ͚Md)j̽~Fs)lMx]YoWYW,~_n}?Bē>c-	<(H$/
<믙|R1̏l,!bSr♮<\dvաɴRb{oLIft6vƭ
3;!&m8*`:z[HඝWZuDfzVM]]jeG+j_cQj%J[,ut!:g-NjM:Om!( e~Bdw2"gqIŀ>,(ngbC+	!jӵJ C؎}wB:FO\`5ikͯ,dn73B=^<3}Lf[M:>I5qZj_n$Ic~#¯q1sbE-"ͱf:bO
׭p~&f9oVU-VUceÞcr>1fţ?gt֓KAJq	Ha1HCe暟1ҢLD&!vЃְmV:pymb	BeIʤXt6e3q*j+1=a=	Ď kqwp&%Qyanso'+)nƛȄ(y۬)$xda> upGO,`#G/Ңx/!MC^5W4J]_BXq0>У+
laeH`@ZC\β?j?J5э9wR	qJVRh$9vdd #L,MM6s!ۋ#OwvvU7Ӧ,ڒ'2';tokrCڊˇzy?z\
^a@Mf'Wk%Ekj8n[AS`r}^r_zܾy;:׭ ;V7$ް1c@aa(:86R5n͍/rmqsLg*[Ȱ"=v`Pܭ[i%1\e߅9Q2`;Kr~A)k!bUQ`+Gs ǫ揯K.PY.Cݤ0v+?m2QƩj4#dp\-]=1i,09YUrSdՓq")ezY<=^Yn=vs`CK0Nӝ=Q9TlR߆kf֪vZEnS=%c'KK&=L~Zܯ9nx/ _j1,ï5ϨxIc{شF@djOPP[~8cc( xHi.;DEO'}FF֏}&K8~o*}M*T-l!~MPki񷍀%RXsN8H˜Ў$/_o^IX{@< Ox:Am0&&(0mW;n谈w_m:]ĸrDo\;5(ot`ˣO&Mt\Sޫ|YuUU='%M9|Gkj&Х#tǰqr7N_T~0;hRv=?BΩ+pCʛ;K.۰yy~/}XE\%{6crlW""[ъE: hdw:yuyT
6pb"aİI0i5,p>ȼfA1`b,&@8D21Nx-CV&w^DȽ ❵C>2=\<Yx9#xIpMY!tv^MRKeg	xmh3or=9}hNU'\/Z%g,w@ʅۙ>ه !UEDs7؛̱--YtLؚ;Fi[He?R$R<*ld!O$X:$[:dPJWX.C#t,7IZ7^*m!Dq`.MGDk%ӓ{&{vk'Q-Ğ24WD:-"]H#h^vcf=ޭ:\*=mu݋fO>Q@gbiEejpja?{#Nm"*T-ݲ]֒9"3B'?A'>DPحdkSKcק,s5%ȭ3J0x&B|1ޣ,d/P!w	غDpc9Վ
Ҽ*LbOIZ8ɇNC~7꠷	֢2o*[MWh#y	6լD	R0&@zI\[><sw&dꬳ<xT}tbٷ-YSǧ~N4K<wI	ÀF'm˧Vxlo)x/}p9r,naX妟?'7v_թ!co־|yd{S9y\5>}|c_EdCpcmͥ<}ڑToaCOܵa6L7CyMip>&ƙmMyK}};kU1<#:q筀C@%">$X듐7',p*I
2DN6!p"En|mћ;%:j󅈍_
SA	^,h5\%iAP&(執3v
N,Wt̐UQ?]>T"8NP:'zҼC,lJқm66񨉘lbnp{guIcG`߮#upin!f@sExCV+t%&dW띖Q.uȤ|Ͷ^'3)NZV/D6rЖqY낽D$Z;}arZ.ՔnS^4eD	Ho?a"s{
.o.u۞=u{19ҡz/QֲxO̢BqGVMۼmmmB]	g;h:j <ͦ l|zvTۖ`쑳)E _k.bOHЭUBi[6r*-_bU|~ 5Wwh=
aa{5(nNdEAD3FO.ڕNa8翢ɔzBDI$W+2\&ZvM$˸$s95I(([fM2U@Խm<Y
_qq6(8:fğXԏ,kfgy3¦`$Zģ4[^O;v	+EG)~u?\Zp-xL[D.jF<i&5
rTS/('s;S~r@6=q9pN/$ Wv
XCóH
LNoFY{ /¬lx8ס4TE&I8!=;*֪%Dڶmv7EAѪJZU#Xm%YXӜ2Jru㞬gI Z_fH`N?Ȳ6ПPz]њĚL; 
K38k>+>=lӠ&3!ۼ{
+VJ:MSBh;_sh2"HXadOex#DBr"B'0~/D&no1*n0O@xZ"
mJUn"/!MYh/ɰUWDt>MIMJލ݋yӥs}
WJ-$x6ur?{ѶN7-p#k{V)Bf3.n-Wsh- V	)Ϸ\!p*I?EBT>*v@Y砬5,|::J\ޙ>rqׅ=+Y<82ud8v[}<"lW06dpʧTdSDXWG~zKLܼam)VR5[8FoBx( C[ 2TM*Ak: ͡BVxI*LΓ$#9G}PZCJdckfwnp)'L+rC*#jgٵNi4H]+0cS7vuΊ04"Dy /Rq~tf( 
uàcNL45(xCb(ywyD8'w]=
8ۉVE1<fݔ9 ^ny8/(m,"XddwO	s??%ғ.IDOqʇ=VPd?.U]`7#nU]:G4Vzf\k_G$=GHeIoB/lp(Hz,	K"z" #%/a?/|H$ñ>g}18+&(:y\]*l]hĳ-XR<5ȝmTQ EH@֙8(6BXUP/ѩV%{Dj|=3O6싘[69"~|F~.Frs&QvxkQ<tIͥ}ChO[/Ԕ{w
{u'GY+0KDif(lc̇(I3e8k~24P>:+ro- p7s242cV2wshq{/|vc087FεcG3V/KBŧw*&5NvapKR&]YRn<5ɇU_<#z\j6#rqW|
m*s,!ȩ}^Zi
WpȮ4uȔq*ն\w6?j0.Nc(pL eWHavKb%1EN^!&uw}:[8`3'0;Oe͐-Ppͽg±x98ָM<[KzktN
QoTD"_6Wp)LԼrګZ탈/ofxඍ[{Y51SF6$[mZ-,VAhʑ-e+{p.F5SBT/
ǋkro/*WW)#HDZxnԘZtK3IPoB'Z}]Pj'/3HPx#$i,ףń/5G&ߎ8so`w{F""KFV="U͛K_1$!mKj2`Ӑfa) #v*z˽Q1@_WPC pak!D}D.ՄKDTOD7XDkZ̨WמJ<-0<Ǣ(.ZjD-R3EbKۤcǔ1r6(TፕlVS#a8v-&e=?fZLGVFQ=֞ż"/-fO[hW"UhK#U,iRPe]uK*םZ!z	'ޤX +kXYl:=kXkXLw4kusr9I9DݦEx.oD{XC<#4ʧP}̏fj/bӔݖ>[:<G, Zsq&&Q|ƴooEGB.~Zw&]&2Nφbg:џB'K%t.yx$
Jߏ޾0jBa
	X!pVr1LCٕE%(ZRn(elc0]Ә1LvaW/KY|,,$
Χs0an_㎇\ݭhѬ2p|ն*I="xV,3f˷|T.$hk`6\b-NĜuثknz*eyxNsQRI /!9@A%PăWr+q(}mg&p.dY1Ds&,BYZH tG;yG&i7Vއޠo|K*~(o<rѕm5ČUv/KEB~)5[)'i>q!`ϐжHǵmy&hL$EmiL  oS?^_wkܫ8* @xJ7ZNp`:GnΫI3Þ3{z/`max-|w&ysE}me݀߄HLRe$=cũ0	 
R.	\hHbNp(K%6:D5+V27O<gQoQ`3,ZdlGza/g8ޢ$Qa'+SPvȲn2ǁq}/,@S8xŐ_IZ_YYt_?MU8̗yBUv_j7ࡐZ4Tت|VN/3?aѶO!Vا=!܎y8EP`5֊s//7&*Lj<{?P.e;D d4wO7JԩBg??vb<096C;{iYENt Թ##ģZ[{)FB|6Ҟލ,4WP~Y~9=^RP}2uu1J<
yWJtjpu39E19iJo?6DlTxƓu;"Â2i*_ONoz3c=Wß[4Sj
c+&ֲHwc{xlHa<h>s}
{>ʍC7!e!Vp8uDi|cknZ!6|۽h.-''bAv$oN ont"vC&A/&3.<!s|g^-h׉8 ~;̐Hv|}{˽`	1mc_ɂ0ĪKڙyc#n5~F{,~Ư~.<>kY|W-BkωοKٕddքIy٩ͅZUR¯R3wRhۣ,0CC$[ma,o5~{OmA}Οmy$9V5.W/goVΐ+??1=UUj73Ê\r^!bl<0/*}r,1RkQb'1QALKN+aXunXEBLf9wRTK?H΀go*b`0qg=4k7\>5تNN<fuG*O5<W xz@+P1}إ6t{R[<ǧ!tX)rog]Kklvxkl=i᷸/Aa4R]^nGuBo󯙭&G?Cu`+geo?>ȻK<3"鼔wڭ:(4CU2y(dn8^I48=#fżYm[A* =ª~4|oDŀ91j3X3jp]҂{˘U/(5vXpR3wdWxؘARZ7;uOycV%ڄĖ]"ɍ c,(λ<bl+$0+={o'Py\l;'nY,Iesy>pG'Ȝ<1]ok2)e&RtDs(_-iOiƍ<膵ypuKˬm8$״Xh=K+l%!FS&J%òxN2?2RޕVJMOfvGf*zngHwX̲m/Z!zXa$toRylIBo	Y˖VC+'zR,hrf$$r;5)ߥC]!ӼpUxkYt02xҰԘ?iAU>Aoyf{Β	wZCL+j[eqΌ4:=g7
Ƥv
򽶯`[QSﻱG&g3gQɼOYsrʌ7/8v2p_k]\>8^;zIǷEq#nnVQp/)}$?X2nGsQ6d{gs8x^ĤLO\%f#i]͖>nݰiÀ@KFGB>9HdlV*Q;& LT^y;+hg~0@6y2Rd,qI0w^}|5KDh X<d27 ࣽjc[XNry}^-O^cj6}N=gRhe`PCĈoTz GL(&R˺d/kp	<-oF7w;ob9ct_6NvxM]7oyY=ev^ĩ[/6gz^cRP0Ţaʳq47	<Ggs7?)\VـPya5:_-`<]%	5ybT-8c:sC_TPa.LJpp>'g'wTOM;|}5rX1@.Ⱥh͡nV7;{1*&.I){CʽЭ[WFe%$unnc8%1 ;_>>QZ(a(%~1jlm2b>ir~ε&̽Fͬ)EN[rV ~=ōl	46<S
l3mA>]jY` rrlTP_YcI[`3 cCnPFK߬'ͲZDLiO&x[A'ɑ3mC;@h3Wc%pg+n쾼qV_O1CgWɨYaƍWv _c/Ɲ$Ȗ6|l%B@٦IJO8r=WF
=8O(pwSS;$72iLaO]SĐ_ɤ!F4Ǔ?50#lJAr̲
}̬J0K3$տmrFE#[[#ow0ڙTRg?3K5̄~m;a ,ybԿЉQJIm=Fgc	=eX+5ͯU뫚A4,5?16?Ec~q*UUG/,vt%ڏe*?t4p-ǯʔ1(G\~`?~xpoe    = false,
      tagHandle,
      tagName,
      ch;

  ch = state.input.charCodeAt(state.position);

  if (ch !== 0x21/* ! */) return false;

  if (state.tag !== null) {
    throwError(state, 'duplication of a tag property');
  }

  ch = state.input.charCodeAt(++state.position);

  if (ch === 0x3C/* < */) {
    isVerbatim = true;
    ch = state.input.charCodeAt(++state.position);

  } else if (ch === 0x21/* ! */) {
    isNamed = true;
    tagHandle = '!!';
    ch = state.input.charCodeAt(++state.position);

  } else {
    tagHandle = '!';
  }

  _position = state.position;

  if (isVerbatim) {
    do { ch = state.input.charCodeAt(++state.position); }
    while (ch !== 0 && ch !== 0x3E/* > */);

    if (state.position < state.length) {
      tagName = state.input.slice(_position, state.position);
      ch = state.input.charCodeAt(++state.position);
    } else {
      throwError(state, 'unexpected end of the stream within a verbatim tag');
    }
  } else {
    while (ch !== 0 && !is_WS_OR_EOL(ch)) {

      if (ch === 0x21/* ! */) {
        if (!isNamed) {
          tagHandle = state.input.slice(_position - 1, state.position + 1);

          if (!PATTERN_TAG_HANDLE.test(tagHandle)) {
            throwError(state, 'named tag handle cannot contain such characters');
          }

          isNamed = true;
          _position = state.position + 1;
        } else {
          throwError(state, 'tag suffix cannot contain exclamation marks');
        }
      }

      ch = state.input.charCodeAt(++state.position);
    }

    tagName = state.input.slice(_position, state.position);

    if (PATTERN_FLOW_INDICATORS.test(tagName)) {
      throwError(state, 'tag suffix cannot contain flow indicator characters');
    }
  }

  if (tagName && !PATTERN_TAG_URI.test(tagName)) {
    throwError(state, 'tag name cannot contain such characters: ' + tagName);
  }

  try {
    tagName = decodeURIComponent(tagName);
  } catch (err) {
    throwError(state, 'tag name is malformed: ' + tagName);
  }

  if (isVerbatim) {
    state.tag = tagName;

  } else if (_hasOwnProperty.call(state.tagMap, tagHandle)) {
    state.tag = state.tagMap[tagHandle] + tagName;

  } else if (tagHandle === '!') {
    state.tag = '!' + tagName;

  } else if (tagHandle === '!!') {
    state.tag = 'tag:yaml.org,2002:' + tagName;

  } else {
    throwError(state, 'undeclared tag handle "' + tagHandle + '"');
  }

  return true;
}

function readAnchorProperty(state) {
  var _position,
      ch;

  ch = state.input.charCodeAt(state.position);

  if (ch !== 0x26/* & */) return false;

  if (state.anchor !== null) {
    throwError(state, 'duplication of an anchor property');
  }

  ch = state.input.charCodeAt(++state.position);
  _position = state.position;

  while (ch !== 0 && !is_WS_OR_EOL(ch) && !is_FLOW_INDICATOR(ch)) {
    ch = state.input.charCodeAt(++state.position);
  }

  if (state.position === _position) {
    throwError(state, 'name of an anchor node must contain at least one character');
  }

  state.anchor = state.input.slice(_position, state.position);
  return true;
}

function readAlias(state) {
  var _position, alias,
      ch;

  ch = state.input.charCodeAt(state.position);

  if (ch !== 0x2A/* * */) return false;

  ch = state.input.charCodeAt(++state.position);
  _position = state.position;

  while (ch !== 0 && !is_WS_OR_EOL(ch) && !is_FLOW_INDICATOR(ch)) {
    ch = state.input.charCodeAt(++state.position);
  }

  if (state.position === _position) {
    throwError(state, 'name of an alias node must contain at least one character');
  }

  alias = state.input.slice(_position, state.position);

  if (!_hasOwnProperty.call(state.anchorMap, alias)) {
    throwError(state, 'unidentified alias "' + alias + '"');
  }

  state.result = state.anchorMap[alias];
  skipSeparationSpace(state, true, -1);
  return true;
}

function composeNode(state, parentIndent, nodeContext, allowToSeek, allowCompact) {
  var allowBlockStyles,
      allowBlockScalars,
      allowBlockCollections,
      indentStatus = 1, // 1: this>parent, 0: this=parent, -1: this<parent
      atNewLine  = false,
      hasContent = false,
      typeIndex,
      typeQuantity,
      typeList,
      type,
      flowIndent,
      blockIndent;

  if (state.listener !== null) {
    state.listener('open', state);
  }

  state.tag    = null;
  state.anchor = null;
  state.kind   = null;
  state.result = null;

  allowBlockStyles = allowBlockScalars = allowBlockCollections =
    CONTEXT_BLOCK_OUT === nodeContext ||
    CONTEXT_BLOCK_IN  === nodeContext;

  if (allowToSeek) {
    if (skipSeparationSpace(state, true, -1)) {
      atNewLine = true;

      if (state.lineIndent > parentIndent) {
        indentStatus = 1;
      } else if (state.lineIndent === parentIndent) {
        indentStatus = 0;
      } else if (state.lineIndent < parentIndent) {
        indentStatus = -1;
      }
    }
  }

  if (indentStatus === 1) {
    while (readTagProperty(state) || readAnchorProperty(state)) {
      if (skipSeparationSpace(state, true, -1)) {
        atNewLine = true;
        allowBlockCollections = allowBlockStyles;

        if (state.lineIndent > parentIndent) {
          indentStatus = 1;
        } else if (state.lineIndent === parentIndent) {
          indentStatus = 0;
        } else if (state.lineIndent < parentIndent) {
          indentStatus = -1;
        }
      } else {
        allowBlockCollections = false;
      }
    }
  }

  if (allowBlockCollections) {
    allowBlockCollections = atNewLine || allowCompact;
  }

  if (indentStatus === 1 || CONTEXT_BLOCK_OUT === nodeContext) {
    if (CONTEXT_FLOW_IN === nodeContext || CONTEXT_FLOW_OUT === nodeContext) {
      flowIndent = parentIndent;
    } else {
      flowIndent = parentIndent + 1;
    }

    blockIndent = state.position - state.lineStart;

    if (indentStatus === 1) {
      if (allowBlockCollections &&
          (readBlockSequence(state, blockIndent) ||
           readBlockMapping(state, blockIndent, flowIndent)) ||
          readFlowCollection(state, flowIndent)) {
        hasContent = true;
      } else {
        if ((allowBlockScalars && readBlockScalar(state, flowIndent)) ||
            readSingleQuotedScalar(state, flowIndent) ||
            readDoubleQuotedScalar(state, flowIndent)) {
          hasContent = true;

        } else if (readAlias(state)) {
          hasContent = true;

          if (state.tag !== null || state.anchor !== null) {
            throwError(state, 'alias node should not have any properties');
          }

        } else if (readPlainScalar(state, flowIndent, CONTEXT_FLOW_IN === nodeContext)) {
          hasContent = true;

          if (state.tag === null) {
            state.tag = '?';
          }
        }

        if (state.anchor !== null) {
          state.anchorMap[state.anchor] = state.result;
        }
      }
    } else if (indentStatus === 0) {
      // Special case: block sequences are allowed to have same indentation level as the parent.
      // http://www.yaml.org/spec/1.2/spec.html#id2799784
      hasContent = allowBlockCollections && readBlockSequence(state, blockIndent);
    }
  }

  if (state.tag === null) {
    if (state.anchor !== null) {
      state.anchorMap[state.anchor] = state.result;
    }

  } else if (state.tag === '?') {
    // Implicit resolving is not allowed for non-scalar types, and '?'
    // non-specific tag is only automatically assigned to plain scalars.
    //
    /